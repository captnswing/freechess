{% extends "base.html" %}

{% block beforebodyend %}
    <title>{{ player }}'s chess stats on freechess.org</title>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}/jquery.flot.js"></script>
    <script>
        $(document).ready(function () {
            $.getJSON('{% url api-elohist %}', function (elodata) {
                $.plot($("#elohistimg"), [elodata.data], {
                    xaxis: {
                        mode: "time"
                    }
                });
            });
        });
    </script>

    {#    <script type="text/javascript">#}
    {#        $(document).ready(function () {#}
    {#            var elohistoptions = {#}
    {#                chart: {#}
    {#                    renderTo: 'elohistimg',#}
    {#                    type: 'line',#}
    {#                    backgroundColor: null,#}
    {#                    spacingLeft: 0#}
    {#                },#}
    {#                title: {#}
    {#                    text: ''#}
    {#                },#}
    {#                subtitle: {#}
    {#                    text: ''#}
    {#                },#}
    {#                xAxis: {#}
    {#                    type: 'datetime',#}
    {#                    showLastLabel: true#}
    {#                },#}
    {#                yAxis: [#}
    {#                    { // left y-axis#}
    {#                        min: 1000,#}
    {#                        title: {#}
    {#                            text: null#}
    {#                        },#}
    {#                        showFirstLabel: false#}
    {#                    },#}
    {#                    { // right y axis#}
    {#                        min: 1000,#}
    {#                        linkedTo: 0,#}
    {#                        opposite: true,#}
    {#                        title: {#}
    {#                            text: null#}
    {#                        },#}
    {#                        showFirstLabel: false#}
    {#                    }#}
    {#                ],#}
    {#                plotOptions: {#}
    {#                    line: {#}
    {#                        lineWidth: 2,#}
    {#                        marker: {#}
    {#                            enabled: false,#}
    {#                            states: {#}
    {#                                hover: {#}
    {#                                    enabled: true,#}
    {#                                    radius: 5#}
    {#                                }#}
    {#                            }#}
    {#                        },#}
    {#                        shadow: false,#}
    {#                        states: {#}
    {#                            hover: {#}
    {#                                lineWidth: 1#}
    {#                            }#}
    {#                        }#}
    {#                    }#}
    {#                },#}
    {#                legend: false,#}
    {#                tooltip: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                credits: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                series: []#}
    {#            };#}
    {##}
    {#            jQuery.getJSON('{% url api-elohist %}', function (chartoptions) {#}
    {#                console.log(chartoptions);#}
    {#                elohistoptions.series = chartoptions['series'];#}
    {#                userchart = new Highcharts.Chart(elohistoptions);#}
    {#            });#}
    {#            var monthlyresultoptions = {#}
    {#                chart: {#}
    {#                    renderTo: 'monthlyresult',#}
    {#                    type: 'column',#}
    {#                    backgroundColor: null,#}
    {#                    spacingLeft: 0#}
    {#                },#}
    {#                title: {#}
    {#                    text: ''#}
    {#                },#}
    {#                subtitle: {#}
    {#                    text: ''#}
    {#                },#}
    {#                yAxis: [#}
    {#                    { // left y-axis#}
    {#                        title: {#}
    {#                            text: null#}
    {#                        },#}
    {#                        showFirstLabel: false#}
    {#                    },#}
    {#                    { // right y axis#}
    {#                        linkedTo: 0,#}
    {#                        opposite: true,#}
    {#                        title: {#}
    {#                            text: null#}
    {#                        },#}
    {#                        showFirstLabel: false#}
    {#                    }#}
    {#                ],#}
    {#                plotOptions: {#}
    {#                    column: {#}
    {#                        stacking: 'normal',#}
    {#                        borderWidth: 0,#}
    {#                        groupPadding: 0,#}
    {#                        pointPadding: 0.05,#}
    {#                        shadow: false#}
    {#                    }#}
    {#                },#}
    {#                legend: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                tooltip: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                credits: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                series: []#}
    {#            };#}
    {##}
    {#            jQuery.getJSON('{% url api-monthlyresult %}', function (chartoptions) {#}
    {#                console.log(chartoptions);#}
    {#                monthlyresultoptions.series = chartoptions['series'];#}
    {#                userchart = new Highcharts.Chart(monthlyresultoptions);#}
    {#            });#}
    {#            var opponentselooptions = {#}
    {#                chart: {#}
    {#                    renderTo: 'opponentselo',#}
    {#                    type: 'column',#}
    {#                    backgroundColor: null,#}
    {#                    spacingLeft: 0#}
    {#                },#}
    {#                title: {#}
    {#                    text: ''#}
    {#                },#}
    {#                subtitle: {#}
    {#                    text: ''#}
    {#                },#}
    {#                yAxis: [#}
    {#                    { // left y-axis#}
    {#                        title: {#}
    {#                            text: null#}
    {#                        },#}
    {#                        showFirstLabel: false#}
    {#                    },#}
    {#                    { // right y axis#}
    {#                        linkedTo: 0,#}
    {#                        opposite: true,#}
    {#                        title: {#}
    {#                            text: null#}
    {#                        },#}
    {#                        showFirstLabel: false#}
    {#                    }#}
    {#                ],#}
    {#                plotOptions: {#}
    {#                    column: {#}
    {#                        stacking: 'normal',#}
    {#                        borderWidth: 0,#}
    {#                        groupPadding: 0,#}
    {#                        pointPadding: 0.05,#}
    {#                        shadow: false#}
    {#                    }#}
    {#                },#}
    {#                legend: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                tooltip: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                credits: {#}
    {#                    enabled: false#}
    {#                },#}
    {#                series: []#}
    {#            };#}
    {##}
    {#            jQuery.getJSON('{% url api-opponentselo %}', function (chartoptions) {#}
    {#                console.log(chartoptions);#}
    {#                opponentselooptions.series = chartoptions['series'];#}
    {#                userchart = new Highcharts.Chart(opponentselooptions);#}
    {#            });#}
    {#        });#}
    {#    </script>#}
{% endblock %}

{% block content %}
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="/">{{ player }}'s chess stats</a>
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#elotrend">stats & elotrend</a></li>
                    <li><a href="#opponents">opponents{% if won_tally or lost_tally %} & results{% endif %}</a></li>
                    <li><a href="#history">last 100 games</a></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <h2></h2>
        <h4>playing on average {{ stats.perday|floatformat }} games/day since recording began
            on {{ stats.firstdate|date:"d M Y" }}</h4>

        <div id="tabs">
        </div>
    </div>

    <div class="container">
        <h3>elotrend {{ stats.startdate|date:"M Y" }} - {{ stats.enddate|date:"M Y" }}</h3>

        <div style="width:900px;height:420px" id="elohistimg"></div>
    </div>

    <div class="container">
        <div class="span3">
            <h3>current elo: {{ stats.currentelo }}</h3>
            <table id="summary" class="table table-condensed">
                <tbody>
                <tr>
                    <td>alltime high
                    <td class="rightalign">{{ stats.alltime_maxelo }}</td>
                    <td class="rightalign">{{ stats.alltime_maxelo_date|date:"Y-m-d" }}</td>
                </tr>
                <tr>
                    <td>alltime low
                    <td class="rightalign">{{ stats.alltime_minelo }}</td>
                    <td class="rightalign">{{ stats.alltime_minelo_date|date:"Y-m-d" }}</td>
                </tr>
                <tr>
                    <td>3months high
                    <td class="rightalign">{{ stats.three_months_maxelo }}</td>
                    <td class="rightalign">{{ stats.three_months_maxelo_date|date:"Y-m-d" }}</td>
                </tr>
                <tr>
                    <td>3months low
                    <td class="rightalign">{{ stats.three_months_minelo }}</td>
                    <td class="rightalign">{{ stats.three_months_minelo_date|date:"Y-m-d" }}</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td></td>
                    <td class="rightalign"><strong>as white</strong></td>
                    <td class="rightalign"><strong>as black</strong></td>
                </tr>
                <tr>
                    <td>won</td>
                    <td class="rightalign">{{ stats.won_as_white }}</td>
                    <td class="rightalign">{{ stats.won_as_black }}</td>
                </tr>
                <tr>
                    <td>drawn</td>
                    <td class="rightalign">{{ stats.drawn_as_white }}</td>
                    <td class="rightalign">{{ stats.drawn_as_black }}</td>
                </tr>
                <tr>
                    <td>lost</td>
                    <td class="rightalign">{{ stats.lost_as_white }}</td>
                    <td class="rightalign">{{ stats.lost_as_black }}</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="span7">
            <h3>monthly performance</h3>

            <div id="monthlyresult"></div>
        </div>
    </div>

    <div class="container">
        <div class="span5">
            {% if won_tally or lost_tally %}
                <h3>result distribution</h3>
                <table id="resulttally" class="table table-condensed">
                    <thead>
                    <tr>
                        <th>result</th>
                        <th class="rightalign">freq.</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- tally of won games -->
                    {% for result in won_tally %}
                        <tr class="won">
                            <td>{{ result.0 }}</td>
                            <td class="rightalign">{{ result.1 }}</td>
                        </tr>
                    {% endfor %}

                    <!-- tally of drawn games -->
                    {% for result in drawn_tally %}
                        <tr class="drawn">
                            <td>{{ result.0 }}</td>
                            <td class="rightalign">{{ result.1 }}</td>
                        </tr>
                    {% endfor %}

                    <!-- tally of lost games -->
                    {% for result in lost_tally %}
                        <tr class="lost">
                            <td>{{ result.0 }}</td>
                            <td class="rightalign">{{ result.1 }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endif %}
        </div>
    </div>

    <div class="container">

        <div class="span4">
            <h3>most played opponents</h3>
            <table id="mostplayed" class="table table-condensed">
                <thead>
                <tr>
                    <th>player</th>
                    <th class="rightalign">won</th>
                    <th class="rightalign">draw</th>
                    <th class="rightalign">lost</th>
                </tr>
                </thead>
                <tbody>
                {% for opponent in most_frequent_opponents %}
                    <tr>
                        <td>{{ opponent.1 }}</td>
                        <td class="rightalign">{{ opponent.0.1 }}</td>
                        <td class="rightalign">{{ opponent.0.2 }}</td>
                        <td class="rightalign">{{ opponent.0.3 }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="span4">
            <h3>Oppontents strength</h3>
            <table id="summaryopponents" class="table table-condensed">
                <tbody>
                <tr>
                    <td>average opponent strength (last 3 months)</td>
                    <td class="rightalign"></td>
                    <td class="rightalign">{{ stats.opponentaverage|floatformat }}</td>
                </tr>
                <tr>
                    <td>games played against stronger opponents</td>
                    <td class="rightalign"></td>
                    <td class="rightalign">{{ stats.stronger|floatformat }}%</td>
                </tr>
                <tr>
                    <td>games played against weaker opponents</td>
                    <td class="rightalign"></td>
                    <td class="rightalign">{{ stats.weaker|floatformat }}%</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="span4">
            <h3>top defeated opponents</h3>
            <table id="topdefeated" class="table table-condensed">
                <thead>
                <tr>
                    <th>elo</th>
                    <th>player</th>
                    <th>date</th>
                </tr>
                </thead>
                <tbody>
                {% for opponent in strongest_opponents_won %}
                    <tr>
                        <td>{{ opponent.0 }}</td>
                        <td>{{ opponent.1 }}</td>
                        <td class="rightalign">{{ opponent.2|date:"M Y" }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="container">
        <div class="12">
            <h3>opponentselo</h3>

            <div id="opponentselo"></div>
        </div>
    </div>

    <div class="container" id="history">
        <div class="span12">
            <h3>last 100 games (of {{ stats.total }} in total)</h3>
            <table class="table table-condensed">
                <thead>
                <tr>
                    <th>#</th>
                    <th>date</th>
                    <th>white</th>
                    <th>black</th>
                    <th>w_elo</th>
                    <th>b_elo</th>
                    <th>timecontrol</th>
                    <th>result</th>
                    {% if won_tally or lost_tally %}
                        <th>comment</th>
                    {% endif %}
                </tr>
                </thead>
                <tbody>
                {% for game in last100games %}
                    <tr>
                        <td>{{ game.game_nr }}</td>
                        <td>{{ game.date|date:"Y-m-d" }}</td>
                        <td>{% if game.self_white %}{{ player }}{% else %}{{ game.opponent_name }}{% endif %}</td>
                        <td>{% if game.self_white %}{{ game.opponent_name }}{% else %}{{ player }}{% endif %}</td>
                        <td>{% if game.self_white %}{{ game.self_elo }}{% else %}{{ game.opponent_elo }}{% endif %}</td>
                        <td>{% if game.self_white %}{{ game.opponent_elo }}{% else %}{{ game.self_elo }}{% endif %}</td>
                        <td>{{ game.timecontrol }}</td>
                        <td>{{ game.result }}</td>
                        {% if won_tally or lost_tally %}
                            <td>{{ game.comment }}</td>
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
